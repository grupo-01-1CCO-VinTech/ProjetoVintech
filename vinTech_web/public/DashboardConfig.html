<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="img/logo.jpeg" type="image/png">
    <title>Configurações - DashBoard</title>
    <link rel="stylesheet" href="css/style-ConfiguracaoDashboard.css">
    <link rel="stylesheet" href="css/style-PadraoDashboard.css">
    <link rel="stylesheet" href="css/style-PadraoTodos.css">
    <script src="js/funcoes.js"></script>
</head>

<body onload="listar_Uvas()">
    <div class="pagina">
        <div class="barra-lateral">
            <div class="barra-logo">
                <span>VinTech</span>
                <img src="img/vintech.jpg" alt="">
            </div>
            <div class="barra-itens">
                <ul>
                    <a href="DashboardHome.html">
                        <li>Home</li>
                    </a>
                    <a href="DashboardPlantacoes.html">
                        <li>Plantações</li>
                    </a>
                    <a id="item_config" class="selected">
                        <li>Configurações</li>
                    </a>
                </ul>
            </div>
            <div class="barra-usuario">
                <div class="barra-fotoUsuario">
                    <img  id="imagemUsuario" src="" alt="Foto Usuário">
                </div>
                <span id="nome_usuario"></span>
                <span id="cargo_usuario"></span>
            </div>
            <div class="barra-button">
                <button onclick="limparSessao()">Sair</button>
            </div>
        </div>

        <div class="container">
            <div class="container-esquerda">
                <div class="respostaForms" id="respostaForms">
                </div>
                <div id="formUsuario" style="display: none;" class="form">
                    <h1>Configuração de Usuários</h1>
                    <button onclick="apagarDivs('formAddUsuario')" class="botaoUsuario">Adicionar Novo Usuário </button>
                    <button onclick="apagarDivs('formEditUsuario')" class="botaoUsuario">Editar e Remover Usuários
                    </button>
                </div>

                <div id="formAddUsuario" style="display: none;" class="form">
                    <div class="tituloUser">
                        <h1>Adicionar Usuário</h1>
                    </div>
                    <div class="ambasUser">
                        <div class="addUser">
                            <p>Função: <select name="optFunc" id="selectUsuarioFuncao">
                                    <option value="0">Funcionário</option>
                                    <option value="1">Administrador</option>
                                </select></p>
                            <p>Nome Completo: <input type="text" id="iptNomeUsuario" class="inp_Input"
                                    placeholder="Digite o nome completo:"></p>
                            <p>E-mail: <input type="text" id="iptEmailUsuario" class="inp_Input"
                                    placeholder="Digite o Email:"></p>
                            <p>Senha: <input type="text" id="iptSenhaUsuario" class="inp_Input"
                                    placeholder="Digite sua senha:"></p>
                            <button onclick="adicionar_Usuario()">Adicionar Usuário</button>
                        </div>
                    </div>
                </div>
                <div id="formEditUsuario" style="display: none;" class="form">
                    <div class="tituloEdit">
                        <h1>Editar ou remover Usuários</h1>
                    </div>
                    <div class="editUser">
                        <div class="linha-form">
                            <input type="text" placeholder="Email do Usuário" id="ipt_email_user">
                            <button onclick="consultar_usuario()">Consultar</button>
                        </div>
                        <div class="linha-form">
                            <input type="text" placeholder="Id do Usuário" id="ipt_id_user" disabled style="display: none;">
                            <input type="text" placeholder="Nome do Usuário" id="ipt_nome_user">
                            <input type="text" placeholder="Email do Usuário" id="ipt_emailAlter_user">
                            <select name="" id="ipt_cargo_user">
                                <option value="Funcionario">Funcionário</option>
                                <option value="Administrador">Administrador</option>
                            </select>

                        </div>
                        <div class="linha-form">
                            <input type="text" placeholder="Senha do Usuário" id="ipt_senha_user">
                            <input type="text" placeholder="Empresa do Usuário" id="ipt_nomeEmpresa_user" disabled>
                            <input type="text" placeholder="Id da Empresa" id="ipt_idEmpresa_user" disabled style="display: none;">
                        </div>
                        <div class="linha-form">
                            <button onclick="alterar_usuario()">Alterar</button>
                            <button onclick="excluir_usuario()">Excluir</button>
                        </div>
                    </div>
                </div>

                <!-- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->

                <div id="formPlantacao" style="display: none;" class="form">
                    <h1>Configuração de Plantações</h1>
                    <button onclick="apagarDivs('formAddPlantacao')">Adicionar nova Plantação</button>
                    <button onclick="apagarDivs('formEditPlantacao')">Editar/Remover Plantações</button>
                </div>

                <div id="formAddPlantacao" style="display: none;" class="form">
                    <h1>Adicionar Plantação</h1>

                    <p>Nome da Plantação <input type="text" id="iptNomePlantacao" placeholder="Plantação Jundiaí"></p>

                    <!-- <p>Localização: <input type="text" id="iptLocalizacaoPlantacao"></p> -->
                    <!-- <p>Tamanho da Plantação: <input type="text" id="iptTamanhoPlantacao" placeholder="Em Hectares"></p> -->
                    <button onclick="adicionar_Plantacao()">Adicionar Plantação</button>
                </div>
                <div id="formEditPlantacao" style="display: none;" class="form">
                    <h1>Editar ou remover Plantações</h1>
                    <p>Por Nome: <input type="text" id="iptEncontrarNomePlantacao" placeholder="Plantação Jundiaí"></p>
                    <button onclick="consultar_plantacao()">Encontrar Plantação</button>
                    <h3>Editar Plantação</h3>
                    <p>Nome: <input type="text" id="iptAlterNomePlantacao"></p>
                    <button onclick="editar_Plantacao()">Editar Plantação</button>
                    <button onclick="deletar_Plantacao()">Deletar Plantação</button>
                </div>

                <!-- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->

                <div id="formEstufa" style="display: none;" class="form">

                    <h1>Configuração de Estufas</h1>
                    <button onclick="apagarDivs('formAddEstufa')">Adicionar nova Estufa</button>
                    <button onclick="apagarDivs('formEditEstufa')">Editar/Remover Estufas</button>
                </div>
                <div id="formAddEstufa" style="display: none;" class="form">
                    <h1>Adicionar Estufa</h1>
                    <p>Nome da Estufa
                        <input type="text" id="iptAddNomeEstufa" placeholder="Estufa 001">
                    </p>
                    <p>Em qual plantação você deseja cadastrar esta estufa?
                        <input type="text" id="iptAddPlantacaoEstufa" placeholder="Id da Plantação">
                    </p>
                    <p>Tipo de Uva:
                        <select id="iptAddUvaEstufa">
                            <option value="0"></option>
                        </select>
                    </p>
                    <p>Tamanho da Estufa <input type="text" id="iptAddTamanhoEstufa"></p>
                    <button onclick="adicionar_Estufa()">Adicionar Estufa</button>
                </div>
                <div id="formEditEstufa" style="display: none;" class="form">
                    <h1>Editar ou remover Estufas</h1>

                    <h3>Encontrar Estufa</h3>
                    <p>Informe a plantação em que a estufa está: <input type="text" id="iptEncontrarPlantacaoEstufa">
                    </p>
                    <p>Por ID: <input type="text" id="iptEncontrarIdEstufa"></p>
                    <button onclick="encontrar_Estufa()">Encontrar Estufa</button>
                    <!-- <p>Por Localização: <input type="text" id="iptLocalizacaoPlantacao"></p> -->
                    <h3>Editar Estufa</h3>
                    <p>Tipo de Uva:
                        <select id="iptEditUvaEstufa">
                            <option value="0"></option>
                        </select>
                    </p>
                    <p>Tamanho da Estufa: <input type="text" id="iptEditTamanhoEstufa"></p>
                    <button onclick="editar_Estufa()">Editar Estufa</button>
                    <h3>Deletar Plantação:</h3>
                    <p>Confirmar Plantação: <input type="text" id="iptDeleteEstufaConfirmacaoPlantacao"></p>
                    <p>Confirmar ID: <input type="text" id="iptDeleteEstufaConfirmacaoID"></p>
                    <button onclick="deletarPlantacao()">Deletar Plantação</button>
                </div>
            </div>
        </div>
        <div class="container-direita">
            <div class="container-usuario">
                <img src="" alt="" id="imagemUsuario2">
                <p id="nomeAdm"></p>
                <p id="emailAdm"></p>
            </div>
            <div class="container-contato">
                <h1>Informações</h1>
                <div id="empresaAdm" class="linha-infoAdm"><span class="spanDivContato">Empresa:</span></div>
                <div id="cargoAdm" class="linha-infoAdm"><span class="spanDivContato">Cargo:</span></div>
                <p>
            </div>
            <div class="container-botoes">
                <button onclick="apagarDivs('formUsuario')" class="config">Configurar Usuários</button>
                <button onclick="apagarDivs('formPlantacao')" class="config">Configurar Plantação</button>
                <button onclick="apagarDivs('formEstufa')" class="config">Configurar Estufa</button>
            </div>

        </div>
    </div>
</body>

</html>

<script>
    var idChefe = sessionStorage.ID_USUARIO;
    var nomeUsuario = sessionStorage.NOME_USUARIO;
    var emailUsuario = sessionStorage.EMAIL_USUARIO;
    var fkEmpresa = sessionStorage.FK_EMPRESA;
    var fkChefe = sessionStorage.ID_CHEFE;
    var imagemAdm = sessionStorage.IMAGEM_USUARIO;

    imagemUsuario.src = imagemAdm
    imagemUsuario2.src = imagemAdm

    validarSessao()

    nomeAdm.innerHTML = `${nomeUsuario}`
    emailAdm.innerHTML += `${emailUsuario}`
    if (fkChefe == 'null') {
        cargoAdm.innerHTML += 'Administrador'
    } else {
        location.href = 'DashboardHome.html'
    }

    function apagarDivs(id) {
        formUsuario.style.display = 'none'
        formPlantacao.style.display = 'none'
        formEstufa.style.display = 'none'
        formAddUsuario.style.display = 'none'
        formEditUsuario.style.display = 'none'
        formAddPlantacao.style.display = 'none'
        formEditPlantacao.style.display = 'none'
        formAddEstufa.style.display = 'none'
        formEditEstufa.style.display = 'none'
        respostaForms.style.display = 'none'


        const form = document.getElementById(id)
        form.style.display = 'flex'
    }

    function adicionar_Plantacao() {
        fetch("/plantacao/adicionar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomePlantacaoServer: iptNomePlantacao.value,
                fkEmpresaServer: fkEmpresa
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                alert('Plantação adicionada com sucesso!')
            } else {
                throw ("Houve um erro ao tentar adicionar a plantação!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
        return false;
    }

    function adicionar_Usuario() {
        var nomeFunc = iptNomeUsuario.value
        var emailFunc = iptEmailUsuario.value
        var senhaFunc = iptSenhaUsuario.value
        var fkChefe = selectUsuarioFuncao.value == 0 ? idChefe : "Adm"
        // alert(fkChefe)

        fetch("/usuarios/cadastrarFuncionario", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nomeFuncServer: nomeFunc,
                emailFuncServer: emailFunc,
                senhaFuncServer: senhaFunc,
                fkChefeServer: fkChefe,
                fkEmpresaServer: fkEmpresa
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                alert('Cadastro efetuado com sucesso!')
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
        return false;
    }

    function consultar_usuario() {
        ipt_nome_user.value = ""
        ipt_id_user.value = ""
        ipt_senha_user.value = ""
        ipt_cargo_user.value = ""
        ipt_emailAlter_user.value = ""

        if (ipt_email_user.value == 0) {
            alert('coloque o email de quem tu vai consultar')
        } else {
            fetch("/usuarios/listar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    emailServer: ipt_email_user.value
                })
            }).then(function (resposta) {
                console.log("ESTOU NO THEN DO entrar()!")

                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log(json);
                        ipt_nome_user.value = json[0].nomeFuncionario
                        ipt_emailAlter_user.value = json[0].emailFuncionario
                        ipt_id_user.value = json[0].idFuncionario
                        ipt_senha_user.value = json[0].senhaFuncionario
                        ipt_cargo_user.value =  json[0].fkChefe== null ? 'Administrador' : "Funcionario"
                        ipt_nomeEmpresa_user.value = json[0].nomeEmpresa
                        ipt_idEmpresa_user.value = json[0].fkEmpresa
                        console.log(JSON.stringify(json));
                    });

                } else {

                    console.log("Houve um erro ao tentar realizar o login!");

                    resposta.text().then(texto => {
                        console.error(texto);
                        finalizarAguardar(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
            })

            return false;
        }

    }

    function alterar_usuario() {
        var idUserAlter = ipt_id_user.value
        var emailUserAlter = ipt_emailAlter_user.value
        var nomeUserAlter = ipt_nome_user.value
        var senhaUserAlter = ipt_senha_user.value
        var cargoUserAlter = ipt_cargo_user.value
        var fkEmpresaAlter = ipt_idEmpresa_user.value
        var fkChefeAlter = ""

        if (cargoUserAlter == 'Funcionario') {
            fkChefeAlter = idChefe
        } else {
            fkChefeAlter = null
        }

        if (ipt_id_user.value == 0) {
            alert('Consulte um usuário antes de alterar!')
        }
        fetch("/usuarios/alterar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idUserServer: idUserAlter,
                emailUserServer: emailUserAlter,
                nomeUserServer: nomeUserAlter,
                senhaUserServer: senhaUserAlter,
                chefeUserServer: fkChefeAlter,
                empresaUserServer: fkEmpresaAlter
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    ipt_nome_user.value = json[0].nomeFuncionario
                    ipt_id_user.value = json[0].idFuncionario
                    ipt_senha_user.value = json[0].senhaFuncionario
                    ipt_cargo_user.value = json[0].fkChefe == null ? 'Administrador' : "Funcionario"
                    console.log(JSON.stringify(json));
                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function excluir_usuario() {
        var idUserDelete = ipt_id_user.value
        if (ipt_id_user.value == 0) {
            alert('Consulte um usuário antes de alterar!')
            return
        }
        fetch("/usuarios/excluir", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idUserServer: idUserDelete
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                console.log(resposta);
            } else {

                console.log("Houve um erro ao tentar deletar o usuario!");

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    //<p>Em qual plantação você deseja cadastrar esta estufa?<input type="text" id="iptAddPlantacaoEstufa"></p>
    //<p>Tipo de Uva: <input type="text" id="iptAddUvaEstufa"></p>
    //<p>Tamanho da Estufa <input type="text" id="iptAddTamanhoEstufa"></p>
    function adicionar_Estufa() {
        if (iptAddUvaEstufa.value == 0) {
            adicionar_Uva()
        } else {
            fetch("/estufa/adicionar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeEstufa: iptAddNomeEstufa.value,
                    idPlantacao: iptAddPlantacaoEstufa.value,
                    tipoUva: iptAddUvaEstufa.value,
                    tamanho: iptAddTamanhoEstufa.value
                })
            }).then(function (resposta) {

                if (resposta.ok) {
                    alert('Cadastro efetuado com sucesso!')
                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
            return false;
        }
    }

    function consultar_plantacao() {
        fetch("/plantacao/consultar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nomePlantacaoServer: iptEncontrarNomePlantacao.value,
                fkEmpresaServer: fkEmpresa
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                            iptAlterNomePlantacao.value = `${json[0].nomePlantacao}`
                });
            } else {
                console.log("Houve um erro ao tentar consultar as plantações");
                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function deletar_Plantacao() {
        fetch("/plantacao/deletar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nomePlantacaoServer: iptEncontrarNomePlantacao.value,
                fkEmpresaServer: fkEmpresa
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                console.log('teste')
            } else {
                console.log("Houve um erro ao tentar consultar as plantações");
                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function listar_platacoes() {
        fetch("/plantacao/listar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkEmpresaServer: fkEmpresa
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    for (let x in json) {
                        respostaForms.innerHTML +=
                            `
                            ID da Plantação: ${json[x].idPlantacao} <br>
                            Nome da Plantação: ${json[x].nomePlantacao}<br>
                        `;
                    }
                });
            } else {
                console.log("Houve um erro ao tentar consultar as plantações");
                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function listar_Uvas() {
        fetch("/uva/listar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkEmpresaServer: fkEmpresa
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    for (let x in json) {
                        iptAddUvaEstufa.innerHTML += `<option value="${json[x].nomeUva}">${json[x].nomeUva}</option>`;
                        iptEditUvaEstufa.innerHTML += `<option value="${json[x].nomeUva}">${json[x].nomeUva}</option> `;
                    }
                });
            } else {
                console.log("Houve um erro ao tentar consultar as uvas");
                resposta.text().then(texto => {
                    console.error(texto);
                });
            }
        }).catch(function (erro) {
            console.log(erro);
        })
        return false;
    }
    listar_platacoes()

    // function adicionar_Uva() {
    //     var nomeUvaServer = iptAddNomeUva.value
    //     var tempMaxServer = iptAddTempMaxUva.value
    //     var tempMinServer = iptAddTempMinUva.value
    //     var umidMaxServer = iptAddUmidMaxUva.value
    //     var umidMinServer = iptAddUmidMinUva.value

    //     fetch("/uva/adicionar", {
    //         method: "POST",
    //         headers: {
    //             "Content-Type": "application/json"
    //         },
    //         body: JSON.stringify({
    //             nomeUva: nomeUvaServer,
    //             tempMax: tempMaxServer,
    //             tempMin: tempMinServer,
    //             umidMax: umidMaxServer,
    //             umidMin: umidMinServer
    //         })
    //     }).then(function (resposta) {
    //         if (resposta.ok) {
    //             console.log(resposta);
    //         } else {
    //             console.log("Houve um erro ao tentar inserir as uvas");
    //             resposta.text().then(texto => {
    //                 console.error(texto);
    //             });
    //         }
    //     }).catch(function (erro) {
    //         console.log(erro);
    //     })
    //     return false;
    // }
</script>